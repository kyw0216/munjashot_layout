<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>마이 페이지</title>

    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <script src="../javascript/external/jquery-3.5.1.min.js"></script>
    <script src="../javascript/external/jquery-ui.min.js"></script>
    <script src="../javascript/Common/modal.js"></script>

    <link rel='stylesheet' type='text/css' media='screen' href='../stylesheet/Common/common.css'>
    <link rel='stylesheet' type='text/css' media='screen' href='../stylesheet/Common/base.css'>

    <script src='../javascript/base/util.js'></script>

    <!-- Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    <link rel="stylesheet" href="../stylesheet/external/font-awesome.css">
    <link rel="stylesheet" href="../stylesheet/external/font-awesome-regular.min.css">
    <link rel="stylesheet" href="../stylesheet/external/font-awesome-solid.min.css">

    <script src="../javascript/external/swiper-4.5.1.min.js"></script>
    <link rel="stylesheet" href="../stylesheet/external/swiper-4.5.1.min.css">

    <!-- uiToast CDN -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
    <script src="https://uicdn.toast.com/tui.code-snippet/v1.5.0/tui-code-snippet.js"></script>
    <script src="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.js"></script>
    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <!-- Moment -->
    <script src="../javascript/external/moment-2.29.1-locale.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#header").load("header.html"); //헤더 인클루드
            $("#footer").load("footer.html"); //푸터부분 인클루드
            $("#leftBar_div").load("leftBar.html"); //푸터부분 인클루드
            $("#rightBar_div").load("rightBar.html"); //푸터부분 인클루드
        });
    </script>

</head>

<body>

    <!-- Header -->
    <div id="header"></div>
    <!-- <div data-include-path="header.html"></div> -->

    <!-- Body -->

    <link rel='stylesheet' type='text/css' media='screen' href='../stylesheet/Page/myPage-unsubscribe.css'>
    <script src='../javascript/Page/myPage-unsubscribe.js'></script>

    <div id="main-body-wrapper" style="min-height: 50% !important;">
        <div id="main-body" style="display: flex; justify-content: center; align-items: center;">
            <main class="body-section">

                <div class="main_content main_content1">
                    <div class="wrapper clearfix">

                        <div class="content_wrapper">

                            <div class="column_wrapper">
                                <div class="row_wrapper" style="justify-content: flex-start;">
                                    <span style="font-size:24px;;">수신거부 리스트 관리</span>
                                </div>
                            </div>
                            
                            <hr style="margin:12px;width: 100%;">

                            <div class="column_wrapper" style="align-items: flex-start; justify-content: center; line-height: normal;">
                                <span style="font-size:20px;">수신거부 리스트에 추가된 번호는 메시지 발송 시 제외됩니다.</span>
                                <span style="font-size:20px;">특정 번호의 수신거부 해지를 원하실 경우 해당 번호를 리스트에서 삭제해주세요.</span><br>
                                <span style="font-size:20px;">※ 문자샷과 연동된 080 수신거부 번호를 이용할 경우 리스트가 자동 업데이트 됩니다.</span>
                            </div>

                            <div class="row_wrapper" style="background-color: #888888; border-radius: 5px; padding:10px;">
                                <div class="menu_select_div">
                                    <input type="radio" id="message" name="menu_select" class="menu_radio_box"  value="message" checked></input><label class="menu_label" for="message">문자</label>
                                </div>
                                <div class="menu_select_div" style="border-left: 1px solid black;">
                                    <input type="radio" id="fax" name="menu_select" class="menu_radio_box" value="fax"></input><label class="menu_label" for="fax">팩스</label>
                                </div>
                            </div>

                            <div class="column_wrapper">
                                <div class="column_wrapper message_div" style="justify-content: flex-start; align-items: flex-start;">

                                    <div class="row_wrapper" style="background-color: white; padding:5px; margin:0; margin-bottom: 20px;">
                                        <div style="display: flex; align-items: center; justify-content: flex-start; flex-grow: 1; margin:0;">
                                            <button class="btn btn-modal" id="btn-modal" data-modal="modal-unsubscribe-add">수신거부 대량등록</button>
                                        </div>

                                        <div style="display: flex; align-items: center; justify-content: flex-end; flex-grow: 1;">
                                            <input type="date"> - <input type="date"> 
                                            <input class="ctrl-input" type="text" style="width: 200px; margin-left: 10px;" placeholder="수신번호 검색" >
                                            <button class="btn" style="margin-left:10px;">검색</button>
                                        </div>
                                    </div>

                                    <div class="row_wrapper" style="justify-content: flex-start; margin:0; height: auto;padding:10px 0;">
                                        <span style="font-size:20px; font-weight: bold;">개인별 추가</span>
                                        <input class="ctrl-input" placeholder="이름" style="width:100px;margin-left:10px;">
                                        <input class="ctrl-input" placeholder="핸드폰" style="width:100px;margin-left:10px;">
                                        <button class="btn" style="width:80px;margin-left:10px;">등록</button>
                                    </div>

                                    <div class="row_wrapper" style="margin:0;">
                                        <div id="grid" style="width:100%;"></div>
                                    </div>

                                    <div class="row_wrapper" style="justify-content: space-between; border: 1px solid #888888; margin:0; padding:10px;">
                                        <div class="row_wrapper" style="margin:0;justify-content: flex-start;">
                                            <span>선택인원</span>
                                            <input id="select_sum" class="ctrl-input" type="text" style="margin-left:10px; width:40px;" readonly value="0">
                                        </div>
                                        <div class="row_wrapper" style="margin:0;">
                                            <span>검색결과</span>
                                            <select style="margin-left:10px;">
                                                <option>50개</option>
                                            </select>
                                        </div>
                                        <div class="row_wrapper" style="margin:0;justify-content: flex-end;">
                                            <button class="btn">선택삭제</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="column_wrapper fax_div" style="justify-content: flex-start; align-items: flex-start; display: none;">
                                    <div class="row_wrapper" style="background-color: white; padding:5px; margin:0; margin-bottom: 20px;">
                                        <div style="display: flex; align-items: center; justify-content: flex-start; flex-grow: 1; margin:0;">
                                            <button class="btn btn-modal" id="btn-modal" data-modal="modal-unsubscribe-add">수신거부 대량등록</button>
                                        </div>

                                        <div style="display: flex; align-items: center; justify-content: flex-end; flex-grow: 1;">
                                            <input type="date"> - <input type="date"> 
                                            <input class="ctrl-input" type="text" style="width: 200px; margin-left: 10px;" placeholder="수신번호 검색" >
                                            <button class="btn" style="margin-left:10px;">검색</button>
                                        </div>
                                    </div>

                                    <div class="row_wrapper" style="justify-content: flex-start; margin:0; height: auto;padding:10px 0;">
                                        <span style="font-size:20px; font-weight: bold;">개인별 추가</span>
                                        <input class="ctrl-input" placeholder="이름" style="width:100px;margin-left:10px;">
                                        <input class="ctrl-input" placeholder="핸드폰" style="width:100px;margin-left:10px;">
                                        <button class="btn" style="width:80px;margin-left:10px;">등록</button>
                                    </div>

                                    <!-- <table class="header_table">
                                        <tr>
                                            <th style="width:60px;"><input id="all_chk" class="chk_box" type="checkbox"></th>
                                            <th>이름</th>
                                            <th>전화번호</th>
                                            <th>등록일자</th>
                                        </tr>
                                    </table> -->

                                    <div class="list_table_div" style="border-bottom:1px solid #bdbdbd;">
                                        <div id="grid" style="width:100%;"></div>
                                    </div>

                                    <div class="row_wrapper" style="justify-content: space-between; border: 1px solid #888888; margin:0; padding:10px;">
                                        <div class="row_wrapper" style="margin:0;justify-content: flex-start;">
                                            <span>선택인원</span>
                                            <input id="select_sum" class="ctrl-input" type="text" style="margin-left:10px; width:40px;" readonly value="0">
                                        </div>
                                        <div class="row_wrapper" style="margin:0;">
                                            <span>검색결과</span>
                                            <select style="margin-left:10px;">
                                                <option>50개</option>
                                            </select>
                                        </div>
                                        <div class="row_wrapper" style="margin:0;justify-content: flex-end;">
                                            <button class="btn">선택삭제</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

            </main>
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-window">
            <div class="title">
                <h2>모달</h2>
            </div>
            <div class="close-area">X</div>
            <div class="content" style="display: flex; justify-content: center; align-items: center;">
                <p>모달입니다.</p>
            </div>
        </div>
    </div>

    <!-- leftBar -->
    <div id="leftBar_div"></div>

    <!-- rightBar -->
    <div id="rightBar_div"></div>

    <!-- Footer -->
    <div id="footer"></div>
    <!-- <div data-include-path="footer.html"></div> -->
</body>

<script>

    let grid_Date = moment("2022-05-01");

    const gridData = [];

    gridData.push({
        name: `엠포플러스`,
        number: `01000000000`,
        register_date: grid_Date.format("YYYY-MM-DD"),
    });
            
    (function() {
        for(let i = 1; i < 30; i++){
            gridData.push({
                name: `엠포플러스`,
                number: `0${1000000000+i}`,
                register_date: grid_Date.add(-1, "day").format("YYYY-MM-DD"),
            });
        }
    })();

    class CustomTextEditor {
        constructor(props) {
            const el = document.createElement('input');
            const { maxLength } = props.columnInfo.editor.options;

            el.type = 'text';
            el.maxLength = maxLength;
            el.value = String(props.value);

            this.el = el;
        }

        getElement() {
            return this.el;
        }

        getValue() {
            return this.el.value;
        }

        mounted() {
            this.el.select();
        }
    }

    class RowNumberRenderer {
        constructor(props) {
            const el = document.createElement('span');
            el.innerHTML = `No.${props.formattedValue}`;
            this.el = el;
        }

        getElement() {
            return this.el;
        }

        render(props) {
            this.el.innerHTML = `No.${props.formattedValue}`;
        }
    }
    
    class CheckboxRenderer {
        constructor(props) {
            const { grid, rowKey } = props;

            const label = document.createElement('label');
            label.className = 'checkbox tui-grid-row-header-checkbox';
            label.setAttribute('for', String(rowKey));

            const hiddenInput = document.createElement('input');
            hiddenInput.className = 'hidden-input';
            hiddenInput.id = String(rowKey);
            hiddenInput.name = 'select_chk'

            const customInput = document.createElement('span');
            customInput.className = 'custom-input';

            label.appendChild(hiddenInput);
            label.appendChild(customInput);

            hiddenInput.type = 'checkbox';
            label.addEventListener('click', (ev) => {
                ev.preventDefault();

                if (ev.shiftKey) {
                    grid[!hiddenInput.checked ? 'checkBetween' : 'uncheckBetween'](rowKey);
                    return;
                }

                grid[!hiddenInput.checked ? 'check' : 'uncheck'](rowKey);
            });

            this.el = label;

            this.render(props);
        }

        getElement() {
            return this.el;
        }

        render(props) {
            const hiddenInput = this.el.querySelector('.hidden-input');
            const checked = Boolean(props.value);

            hiddenInput.checked = checked;
        }
    }


    const Grid = tui.Grid;
    const option = {
        el: document.getElementById('grid'), // Container element
        data: gridData,
        scrollX: false,
        scrollY: false,
        minBodyHeight: 30,
        rowHeaders: [
        {
            type: 'checkbox',
            header: `
            <label for="all-checkbox" class="checkbox">
                <input type="checkbox" id="all-checkbox" class="hidden-input" name="_checked"/>
                <span class="custom-input"></span>
            </label>
            `,
            renderer: {
                type: CheckboxRenderer
            }
        }],
        pageOptions: {
            useClient: true,
            perPage: 10
        },
        columns: [
            {
                header: '이름',
                name: 'name',
                align: 'center',
                editor: {
                    type: CustomTextEditor,
                    options: {
                        maxLength: 100
                    }
                },
                sortingType: 'desc',
                sortable: true
            },
            {
                header: '전화번호',
                name: 'number',
                align: 'center',
                editor: {
                    type: CustomTextEditor,
                    options: {
                        maxLength: 100
                    }
                },
                filter: { type: 'text', showApplyBtn: true, showClearBtn: true },
                sortingType: 'desc',
                sortable: true
            },
            {
                header: '등록일자',
                name: 'register_date',
                align: 'center',
                sortingType: 'desc',
                sortable: true,
                filter: {
                    type: 'date',
                    options: {
                        format: 'yyyy-MM-dd'
                    },
                },
            },
        ],
        contextMenu: ({ rowKey, columnName }) => (
            [
                [
                    {
                        name: 'export',
                        label: 'Export',
                        subMenu: [
                            {
                                name: 'default',
                                label: '전체 export',
                                subMenu: [
                                    {
                                        name: 'csvExport',
                                        label: 'CSV export',
                                        action: () => {
                                            instance.export('csv');
                                        }
                                    },
                                    {
                                        name: 'excelExport',
                                        label: 'Excel export',
                                        action: () => {
                                            instance.export('xlsx');
                                        }
                                    },
                                ]
                            },
                            {
                                name: 'includeHeader',
                                label: '헤더를 제외하고 export',
                                subMenu: [
                                    {
                                        name: 'csvExport',
                                        label: 'CSV export',
                                        action: () => {
                                            instance.export('csv', { includeHeader: false });
                                        }
                                    },
                                    {
                                        name: 'excelExport',
                                        label: 'Excel export',
                                        action: () => {
                                            instance.export('xlsx', { includeHeader: false });
                                        }
                                    },
                                ]
                            },
                            {
                                name: 'onlySelected',
                                label: '선택한 영역 export',
                                subMenu: [
                                    {
                                        name: 'csvExport',
                                        label: 'CSV export',
                                        action: () => {
                                            instance.export('csv', { onlySelected: true });
                                        }
                                    },
                                    {
                                        name: 'excelExport',
                                        label: 'Excel export',
                                        action: () => {
                                            instance.export('xlsx', { onlySelected: true });
                                        }
                                    },
                                ]
                            },
                        ],
                    }
                ],
            ]
        )
    }

    const instance = new Grid(option);

    Grid.applyTheme('striped'); // Call API of static method
    
    instance.on('check', function(ev) {
        console.log(ev);

        $("#select_sum").val($("input[name=select_chk]:checked").length+1);
    });
    
    instance.on('uncheck', function(ev) {
        console.log('uncheck', ev);
        
        $("#select_sum").val($("input[name=select_chk]:checked").length-1);
    });

</script>
</html>